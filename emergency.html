<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saksham - Safety</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap');
        body { font-family: 'Lexend', sans-serif; background-color: #FEF2F2; user-select: none; overflow: hidden; }
        .touch-target { cursor: pointer; transition: transform 0.1s; }
        .touch-target:active { transform: scale(0.95); }
        
        /* Traffic Light Styles */
        .light { width: 80px; height: 80px; border-radius: 50%; background: #374151; margin: 10px auto; transition: background 0.3s; border: 4px solid #111; }
        .light.red.active { background: #EF4444; box-shadow: 0 0 20px #EF4444; }
        .light.green.active { background: #10B981; box-shadow: 0 0 20px #10B981; }
        
        /* Animations */
        @keyframes walk { 0% { transform: translateX(0); } 100% { transform: translateX(200px); } }
        .walking-anim { animation: walk 3s linear forwards; }
    </style>
</head>
<body>

<div id="app" class="relative h-screen w-full max-w-2xl mx-auto border-x-2 border-gray-200 bg-white shadow-2xl flex flex-col">
    
    <!-- HEADER -->
    <div class="p-4 flex justify-between items-center bg-white border-b border-gray-200 z-10">
        <div class="bg-red-50 px-4 py-2 rounded-full border border-red-100 text-red-700 font-bold">ğŸš¨ Safety Levels 1-2</div>
        <div class="text-gray-500 font-bold" id="student-name-display">Student</div>
    </div>

    <!-- LEVEL 1: FIRE (Existing) -->
    <div id="screen-situation" class="flex-1 flex flex-col items-center justify-center p-4 bg-red-50">
        <div class="bg-white px-3 py-1 rounded-full text-xs font-bold mb-4 shadow">Level 1: Home Safety</div>
        <div class="mb-8 relative"><div class="text-9xl">ğŸ </div><div class="absolute bottom-0 right-0 text-8xl animate-pulse">ğŸ”¥</div></div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Oh no! Fire!</h1>
        <button onclick="gotoHelperSelection()" class="bg-red-600 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-lg hover:bg-red-700 border-b-4 border-red-900">Call for Help ğŸ“</button>
        <br>
        <a href="index.html" class="mt-8 text-gray-400 font-bold text-sm">â¬… Exit Class</a>
    </div>

    <!-- Helper & Dialpad Screens (Hidden for brevity, logic handles them) -->
    <div id="screen-helper" class="hidden flex-1 flex flex-col bg-white p-8 items-center">
        <h2 class="text-2xl font-bold mb-8">Who helps with fire?</h2>
        <div class="grid grid-cols-1 gap-6 w-full max-w-xs">
            <div onclick="handleWrongHelper(this)" class="touch-target bg-blue-50 border-4 border-blue-100 rounded-xl p-6 flex gap-4"><span class="text-4xl">ğŸ“®</span><span class="text-xl font-bold">Postman</span></div>
            <div onclick="handleCorrectHelper()" class="touch-target bg-red-50 border-4 border-red-200 rounded-xl p-6 flex gap-4"><span class="text-4xl">ğŸ‘¨â€ğŸš’</span><span class="text-xl font-bold">Firefighter</span></div>
        </div>
    </div>

    <!-- LEVEL 2: TRAFFIC (NEW!) -->
    <div id="screen-traffic" class="hidden flex-1 flex flex-col bg-gray-800 relative">
        <div class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-white px-4 py-1 rounded-full text-xs font-bold">Level 2: Road Safety</div>
        
        <!-- Traffic Light -->
        <div class="absolute top-16 left-1/2 transform -translate-x-1/2 bg-black p-4 rounded-2xl border-4 border-gray-600">
            <div id="light-red" class="light red active"></div>
            <div id="light-green" class="light green"></div>
        </div>

        <!-- Road -->
        <div class="mt-auto h-48 bg-gray-600 border-t-8 border-gray-400 relative overflow-hidden w-full flex items-center">
            <!-- Zebra Crossing -->
            <div class="absolute w-full h-full flex justify-around">
                <div class="w-12 h-full bg-white opacity-30 skew-x-12"></div>
                <div class="w-12 h-full bg-white opacity-30 skew-x-12"></div>
                <div class="w-12 h-full bg-white opacity-30 skew-x-12"></div>
                <div class="w-12 h-full bg-white opacity-30 skew-x-12"></div>
            </div>
            <!-- The Kid -->
            <div id="walker" class="absolute left-10 text-8xl transition-transform z-10">ğŸš¶</div>
        </div>

        <!-- Controls -->
        <div class="bg-gray-900 p-6 flex justify-center">
            <button onclick="tryToCross()" class="bg-blue-600 text-white text-2xl font-bold py-6 px-16 rounded-full shadow-lg border-b-8 border-blue-800 active:border-b-0 active:translate-y-2">
                CROSS THE ROAD ğŸƒ
            </button>
        </div>
    </div>

    <!-- SUCCESS -->
    <div id="screen-success" class="hidden h-screen flex flex-col items-center justify-center bg-green-600 text-white">
        <div class="text-9xl mb-4">ğŸ›¡ï¸</div>
        <h1 class="text-5xl font-bold">Safe!</h1>
        <p class="text-xl mt-4">You know the rules!</p>
        <button onclick="location.href='index.html'" class="mt-12 bg-white text-green-700 font-bold py-3 px-8 rounded-full shadow-lg">Home ğŸ </button>
    </div>

</div>

<script>
    let currentStudentName = "Guest";
    let isGreen = false;
    let trafficInterval;

    window.onload = function() {
        const storedName = localStorage.getItem('saksham_student_name');
        if (storedName) currentStudentName = storedName;
        document.getElementById('student-name-display').innerText = currentStudentName;
    };

    const synth = window.speechSynthesis;
    function speak(text) {
        if(synth.speaking) return;
        const u = new SpeechSynthesisUtterance(text);
        u.rate = 0.9;
        synth.speak(u);
    }

    // L1: Fire Logic
    function gotoHelperSelection() {
        document.getElementById('screen-situation').classList.add('hidden');
        document.getElementById('screen-helper').classList.remove('hidden');
        speak("Who puts out the fire?");
    }
    function handleWrongHelper(el) {
        el.style.opacity = "0.5"; speak("No. Try again.");
    }
    function handleCorrectHelper() {
        speak("Correct! Now Level 2. Traffic Rules.");
        setTimeout(() => {
            document.getElementById('screen-helper').classList.add('hidden');
            document.getElementById('screen-traffic').classList.remove('hidden');
            startTrafficCycle();
        }, 1000);
    }

    // L2: Traffic Logic
    function startTrafficCycle() {
        speak("Only cross when the light is Green.");
        setInterval(() => {
            isGreen = !isGreen;
            if (isGreen) {
                document.getElementById('light-red').classList.remove('active');
                document.getElementById('light-green').classList.add('active');
                speak("Green light.");
            } else {
                document.getElementById('light-green').classList.remove('active');
                document.getElementById('light-red').classList.add('active');
                speak("Red light. Stop.");
            }
        }, 4000); // Change every 4 seconds
    }

    function tryToCross() {
        if (isGreen) {
            // Success
            document.getElementById('walker').classList.add('walking-anim');
            speak("Safe to cross. Walking.");
            setTimeout(() => {
                document.getElementById('screen-traffic').classList.add('hidden');
                document.getElementById('screen-success').classList.remove('hidden');
                sendDataToBackend();
            }, 3000);
        } else {
            // Fail
            speak("Stop! Red light means Danger!");
            document.getElementById('screen-traffic').classList.add('bg-red-900');
            setTimeout(() => document.getElementById('screen-traffic').classList.remove('bg-red-900'), 500);
            if(navigator.vibrate) navigator.vibrate(500);
        }
    }

    function sendDataToBackend() {
        const googleScriptURL = "PASTE_YOUR_URL_HERE"; // <--- PASTE HERE
        if (googleScriptURL.includes("script.google.com")) {
            fetch(googleScriptURL, {
                method: 'POST', mode: 'no-cors', 
                body: JSON.stringify({
                    studentId: currentStudentName,
                    module: "Safety: Advanced",
                    level: "Traffic L2",
                    score: 100,
                    attempts: 1,
                    timeTaken: 60
                })
            });
        }
    }
</script>
</body>
</html>
