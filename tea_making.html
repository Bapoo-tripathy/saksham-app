<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saksham - Making Tea</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap');
        body { font-family: 'Lexend', sans-serif; background-color: #FFF7ED; user-select: none; overflow: hidden; }
        .touch-target { cursor: pointer; transition: transform 0.1s; }
        .touch-target:active { transform: scale(0.9); }
        
        /* Animations */
        @keyframes flicker { 0% { opacity: 0.8; transform: scaleY(1); } 50% { opacity: 1; transform: scaleY(1.1); } 100% { opacity: 0.8; transform: scaleY(1); } }
        .flame { animation: flicker 0.2s infinite; }
        @keyframes boil { 0% { transform: translateY(0); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0); } }
        .boiling { animation: boil 0.5s infinite; }
        @keyframes flashRed { 0% { background-color: rgba(255, 0, 0, 0); } 50% { background-color: rgba(255, 0, 0, 0.5); } 100% { background-color: rgba(255, 0, 0, 0); } }
        .hazard-anim { animation: flashRed 0.5s; }
        @keyframes scrub { 0% { transform: rotate(0deg); } 25% { transform: rotate(10deg); } 75% { transform: rotate(-10deg); } }
        .scrub-anim { animation: scrub 0.2s infinite; }
    </style>
</head>
<body>

<div id="app" class="relative h-screen w-full max-w-2xl mx-auto border-x-2 border-gray-200 bg-white shadow-2xl flex flex-col">
    
    <div class="p-4 flex justify-between z-50 bg-white shadow-sm">
        <div class="bg-orange-100 px-4 py-2 rounded-full border border-orange-200 text-orange-800 font-bold">
            ğŸ‘¨â€ğŸ³ <span id="student-name-display">Chef Guest</span>
        </div>
        <button onclick="speak('Audio Test')" class="bg-blue-100 p-2 rounded-full">ğŸ”Š</button>
    </div>

    <!-- INTRO -->
    <div id="screen-intro" class="flex-1 flex flex-col items-center justify-center p-8 bg-orange-50">
        <div class="text-8xl mb-6">ğŸ«–</div>
        <h1 class="text-4xl font-bold text-orange-600 mb-2">Let's Make Tea</h1>
        <p class="text-xl text-gray-500 mb-8">Levels 1-5: Prepare, Serve, Clean</p>
        <button onclick="startLevel1()" class="bg-green-500 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-lg hover:bg-green-600 border-b-4 border-green-700">Start Cooking â–¶</button>
        <br><a href="index.html" class="mt-8 text-gray-400 font-bold">â¬… Back to Menu</a>
    </div>

    <!-- L1: INGREDIENTS -->
    <div id="screen-ingredients" class="hidden flex-1 flex flex-col bg-white justify-center">
        <div class="px-8 text-center mb-8"><h2 class="text-3xl font-bold text-gray-800">Pick items for <span class="text-orange-600">Tea</span></h2></div>
        <div class="grid grid-cols-2 gap-4 p-8 items-center">
            <div onclick="selectIngredient(this, true)" class="touch-target bg-blue-50 border-4 border-blue-200 rounded-xl p-4 flex flex-col items-center h-40 justify-center"><div class="text-5xl">ğŸ¥›</div><span class="mt-2 font-bold text-gray-600">Milk</span></div>
            <div onclick="selectIngredient(this, false)" class="touch-target bg-pink-50 border-4 border-pink-200 rounded-xl p-4 flex flex-col items-center h-40 justify-center"><div class="text-5xl">ğŸ§¼</div><span class="mt-2 font-bold text-gray-600">Soap</span></div>
            <div onclick="selectIngredient(this, true)" class="touch-target bg-green-50 border-4 border-green-200 rounded-xl p-4 flex flex-col items-center h-40 justify-center"><div class="text-5xl">ğŸŒ¿</div><span class="mt-2 font-bold text-gray-600">Tea Leaves</span></div>
            <div onclick="selectIngredient(this, false)" class="touch-target bg-red-50 border-4 border-red-200 rounded-xl p-4 flex flex-col items-center h-40 justify-center"><div class="text-5xl">âš½</div><span class="mt-2 font-bold text-gray-600">Ball</span></div>
        </div>
    </div>

    <!-- L2: SAFETY -->
    <div id="screen-safety" class="hidden flex-1 flex flex-col bg-gray-100 relative items-center justify-center">
        <div id="safety-overlay" class="absolute inset-0 pointer-events-none z-50"></div>
        <div class="mb-12 px-8 text-center"><h2 class="text-3xl font-bold text-red-600">Safety First!</h2><p class="text-xl">Touch the <span class="text-green-600 font-bold">Safe Handle</span></p></div>
        <div class="relative w-64 h-64">
            <div class="absolute bottom-0 left-10 w-40 h-20 bg-orange-400 blur-md opacity-50 flame"></div>
            <div onclick="handleHotTouch()" class="absolute bottom-10 left-4 w-52 h-40 bg-gray-400 rounded-b-3xl border-4 border-gray-600 flex items-center justify-center cursor-pointer"><span class="text-4xl boiling">ğŸ’§</span><span class="absolute -top-8 text-red-500 font-bold animate-pulse">HOT</span></div>
            <div onclick="handleSafeTouch()" class="absolute bottom-20 -right-8 w-12 h-24 bg-black rounded-r-xl cursor-pointer border-4 border-gray-600 hover:bg-gray-800 transition-colors"></div>
        </div>
    </div>

    <!-- L3: SEQUENCING -->
    <div id="screen-sequence" class="hidden flex-1 flex flex-col bg-white">
        <div class="p-4 text-center"><h2 class="text-2xl font-bold text-gray-800">Step-by-Step</h2></div>
        <div class="h-48 flex items-center justify-center bg-gray-50 border-b-4 border-gray-200">
            <div class="relative w-40 h-32 bg-gray-300 rounded-b-3xl border-4 border-gray-500 overflow-hidden"><div id="pot-liquid" class="absolute bottom-0 w-full h-0 bg-blue-300 transition-all duration-1000"></div></div>
        </div>
        <div class="flex-1 p-4 grid grid-cols-1 gap-2 overflow-y-auto">
            <button id="btn-water" onclick="doStep('water')" class="touch-target bg-blue-100 p-4 rounded-xl flex items-center gap-4 border-2 border-blue-300"><span class="text-4xl">ğŸ’§</span><span class="block font-bold text-lg">1. Pour Water</span></button>
            <button id="btn-heat" onclick="doStep('heat')" class="touch-target bg-gray-100 p-4 rounded-xl flex items-center gap-4 border-2 border-gray-300 opacity-50 pointer-events-none"><span class="text-4xl">ğŸ”¥</span><span class="block font-bold text-lg">2. Turn on Stove</span></button>
            <button id="btn-leaves" onclick="doStep('leaves')" class="touch-target bg-gray-100 p-4 rounded-xl flex items-center gap-4 border-2 border-gray-300 opacity-50 pointer-events-none"><span class="text-4xl">ğŸŒ¿</span><span class="block font-bold text-lg">3. Add Tea Leaves</span></button>
            <button id="btn-milk" onclick="doStep('milk')" class="touch-target bg-gray-100 p-4 rounded-xl flex items-center gap-4 border-2 border-gray-300 opacity-50 pointer-events-none"><span class="text-4xl">ğŸ¥›</span><span class="block font-bold text-lg">4. Add Milk</span></button>
        </div>
    </div>

    <!-- L4: SERVING (NEW) -->
    <div id="screen-serving" class="hidden flex-1 flex flex-col bg-yellow-50 items-center justify-center p-4">
        <h2 class="text-2xl font-bold text-yellow-800 mb-8">Serve the Guest</h2>
        
        <!-- Guest -->
        <div class="mb-8 text-center">
            <div class="text-6xl">ğŸ‘´</div>
            <div class="font-bold text-gray-500">Grandpa</div>
        </div>

        <!-- Tray Area -->
        <div class="bg-white p-6 rounded-xl shadow-lg border-4 border-yellow-200 w-full max-w-sm">
            <p class="text-center text-sm text-gray-400 mb-4">Tap to arrange items on tray</p>
            <div class="flex justify-around text-6xl">
                <div onclick="serveItem(this)" class="opacity-30 grayscale touch-target">ğŸ½ï¸</div>
                <div onclick="serveItem(this)" class="opacity-30 grayscale touch-target">â˜•</div>
                <div onclick="serveItem(this)" class="opacity-30 grayscale touch-target">ğŸª</div>
            </div>
        </div>
    </div>

    <!-- L5: CLEANING (NEW) -->
    <div id="screen-cleaning" class="hidden flex-1 flex flex-col bg-blue-50 items-center justify-center p-4">
        <h2 class="text-2xl font-bold text-blue-800 mb-2">Clean Up!</h2>
        <p class="text-gray-500 mb-8">Tap the pot to scrub it clean</p>
        
        <div class="relative">
            <div id="dirty-pot" onclick="scrubPot()" class="text-9xl cursor-pointer relative">
                ğŸ«–
                <!-- Dirt overlays -->
                <div id="dirt-1" class="absolute top-4 left-4 text-4xl opacity-80">ğŸŸ¤</div>
                <div id="dirt-2" class="absolute bottom-4 right-4 text-4xl opacity-80">ğŸŸ¤</div>
                <div id="dirt-3" class="absolute top-4 right-4 text-4xl opacity-80">ğŸŸ¤</div>
            </div>
            <div id="bubbles" class="absolute -top-4 -right-4 text-4xl hidden">ğŸ«§</div>
        </div>
        
        <div class="mt-8 w-64 bg-gray-200 rounded-full h-4">
            <div id="clean-progress" class="bg-blue-500 h-4 rounded-full" style="width: 0%"></div>
        </div>
    </div>

    <!-- SUCCESS -->
    <div id="screen-success" class="hidden h-full flex flex-col items-center justify-center bg-green-600 text-white">
        <div class="text-8xl mb-4">ğŸ†</div>
        <h1 class="text-5xl font-bold">Master Chef!</h1>
        <p class="text-xl mt-4 opacity-90">You made tea, served, and cleaned up!</p>
        <button onclick="location.href='index.html'" class="mt-12 bg-white text-green-700 font-bold py-3 px-8 rounded-full shadow-lg">Back to Menu ğŸ </button>
    </div>

</div>

<script>
    let itemsCollected = 0;
    let currentStep = 0;
    let currentStudentName = "Guest";
    let attemptsCount = 1;
    
    // Serving State
    let servedCount = 0;
    // Cleaning State
    let scrubCount = 0;

    window.onload = function() {
        const storedName = localStorage.getItem('saksham_student_name');
        if (storedName) currentStudentName = storedName;
        document.getElementById('student-name-display').innerText = "Chef " + currentStudentName;
    };

    const synth = window.speechSynthesis;
    function speak(text) {
        if(synth.speaking) return;
        const u = new SpeechSynthesisUtterance(text);
        u.rate = 0.9;
        synth.speak(u);
    }

    function startLevel1() {
        document.getElementById('screen-intro').classList.add('hidden');
        document.getElementById('screen-ingredients').classList.remove('hidden');
        speak("Chef " + currentStudentName + ", pick the things we need for Tea.");
    }

    // L1
    function selectIngredient(el, isCorrect) {
        if (!isCorrect) {
            el.style.opacity = "0.2"; attemptsCount++; speak("No. We don't use that.");
        } else {
            if (el.style.borderColor === "green") return;
            el.style.borderColor = "green"; el.style.backgroundColor = "#dcfce7"; itemsCollected++; speak("Correct!");
            if (itemsCollected === 2) {
                setTimeout(() => {
                    document.getElementById('screen-ingredients').classList.add('hidden');
                    document.getElementById('screen-safety').classList.remove('hidden');
                    speak("Be careful. The stove is hot. Touch the safe handle.");
                }, 1000);
            }
        }
    }

    // L2
    function handleHotTouch() {
        const overlay = document.getElementById('safety-overlay');
        overlay.classList.add('hazard-anim'); attemptsCount++;
        setTimeout(() => overlay.classList.remove('hazard-anim'), 500);
        speak("Stop! That is hot!");
    }
    function handleSafeTouch() {
        speak("Good job!");
        setTimeout(() => {
            document.getElementById('screen-safety').classList.add('hidden');
            document.getElementById('screen-sequence').classList.remove('hidden');
            speak("Now, let's make the tea step by step.");
        }, 1500);
    }

    // L3
    function doStep(stepName) {
        const potLiquid = document.getElementById('pot-liquid');
        if (stepName === 'water' && currentStep === 0) {
            potLiquid.style.height = "50%"; potLiquid.classList.add('boiling'); enableNextButton('btn-heat'); speak("Water poured."); currentStep++;
        } else if (stepName === 'heat' && currentStep === 1) {
            enableNextButton('btn-leaves'); speak("Heat is on."); currentStep++;
        } else if (stepName === 'leaves' && currentStep === 2) {
            potLiquid.style.backgroundColor = "#78350f"; enableNextButton('btn-milk'); speak("Tea leaves added."); currentStep++;
        } else if (stepName === 'milk' && currentStep === 3) {
            potLiquid.style.backgroundColor = "#d97706"; potLiquid.style.height = "80%";
            speak("Tea is ready. Now serve it.");
            setTimeout(() => {
                document.getElementById('screen-sequence').classList.add('hidden');
                document.getElementById('screen-serving').classList.remove('hidden'); // Go to Level 4
            }, 2000);
        }
    }
    function enableNextButton(btnId) {
        const btn = document.getElementById(btnId);
        btn.classList.remove('opacity-50', 'pointer-events-none');
        btn.classList.add('bg-blue-100', 'border-blue-300');
    }

    // L4: Serving
    function serveItem(el) {
        if (el.classList.contains('grayscale')) {
            el.classList.remove('grayscale', 'opacity-30');
            el.classList.add('pop-anim');
            servedCount++;
            speak("Nice.");
            if (servedCount === 3) {
                setTimeout(() => {
                    document.getElementById('screen-serving').classList.add('hidden');
                    document.getElementById('screen-cleaning').classList.remove('hidden'); // Go to Level 5
                    speak("Tea time is over. Now clean the dirty pot.");
                }, 1000);
            }
        }
    }

    // L5: Cleaning
    function scrubPot() {
        scrubCount++;
        const pot = document.getElementById('dirty-pot');
        const bubbles = document.getElementById('bubbles');
        
        pot.classList.add('scrub-anim');
        bubbles.style.display = 'block';
        setTimeout(() => { pot.classList.remove('scrub-anim'); bubbles.style.display = 'none'; }, 200);

        document.getElementById('clean-progress').style.width = (scrubCount * 10) + "%";

        if (scrubCount === 3) document.getElementById('dirt-1').style.display = 'none';
        if (scrubCount === 6) document.getElementById('dirt-2').style.display = 'none';
        if (scrubCount === 10) {
            document.getElementById('dirt-3').style.display = 'none';
            speak("All clean! You are a Master Chef.");
            sendDataToBackend();
            setTimeout(() => {
                document.getElementById('screen-cleaning').classList.add('hidden');
                document.getElementById('screen-success').classList.remove('hidden');
            }, 1000);
        }
    }

    function sendDataToBackend() {
        const googleScriptURL = "PASTE_YOUR_URL_HERE"; // <--- PASTE HERE
        if (googleScriptURL.includes("script.google.com")) {
            fetch(googleScriptURL, {
                method: 'POST', mode: 'no-cors', 
                body: JSON.stringify({
                    studentId: currentStudentName,
                    module: "Home Science: Advanced",
                    level: "L5 Cleaning",
                    score: 100,
                    attempts: attemptsCount,
                    timeTaken: 180
                })
            });
        }
    }
</script>
<style>.pop-anim { animation: pop 0.3s ease-in-out; } @keyframes pop { 50% { transform: scale(1.2); } }</style>
</body>
</html>
