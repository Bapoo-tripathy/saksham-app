<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saksham - Money Math</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap');
        body { font-family: 'Lexend', sans-serif; background-color: #F0F9FF; user-select: none; overflow: hidden; }
        .touch-target { transition: transform 0.1s ease; cursor: pointer; }
        .touch-target:active { transform: scale(0.95); }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .pop-anim { animation: pop 0.3s ease-in-out; }
        .coin { box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        
        /* Level 3 Counter Styles */
        .bill-slot { background: #1f2937; color: #10b981; font-family: monospace; border: 4px solid #374151; }
    </style>
</head>
<body>

<div id="app">
    <!-- SCREEN 1: WELCOME -->
    <div id="screen-welcome" class="h-screen flex flex-col items-center justify-center bg-white p-4">
        <div class="text-6xl mb-4">ğŸ˜</div>
        <h1 class="text-4xl font-bold text-blue-600 mb-2">Saksham</h1>
        <p class="text-xl text-gray-500 mb-8">Money Math Levels 1-3</p>
        
        <input type="text" id="student-name-input" class="p-4 border-2 rounded-lg text-center text-xl mb-4 hidden" placeholder="Enter Name" />
        <h2 id="welcome-message" class="text-2xl text-blue-800 font-bold mb-8 hidden">Welcome back!</h2>

        <button onclick="startGame()" class="touch-target bg-green-500 hover:bg-green-600 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-lg border-b-4 border-green-700 transition-all">
            Start Shopping â–¶
        </button>
        <br>
        <a href="index.html" class="mt-8 text-gray-400 font-bold">â¬… Back to Menu</a>
    </div>

    <!-- SCREEN 2: LEVEL 1 (IDENTIFICATION) -->
    <div id="screen-level1" class="hidden h-screen flex flex-col bg-yellow-50">
        <div class="p-4 flex justify-between items-center bg-white shadow-sm">
            <span class="bg-yellow-200 text-yellow-800 px-3 py-1 rounded-full text-sm font-bold">Level 1</span>
            <button onclick="speak('Find the 10 Rupee Coin')" class="bg-blue-100 p-2 rounded-full">ğŸ”Š</button>
        </div>
        <div class="p-8 text-center"><h2 class="text-3xl font-bold text-gray-800">Find <span class="text-blue-600">10 Rupees</span></h2></div>
        <div class="flex-1 flex items-center justify-center gap-8 p-4">
            <div id="item-flower" onclick="handleWrongAnswer('item-flower')" class="touch-target w-32 h-32 bg-pink-200 rounded-full flex items-center justify-center text-6xl shadow-md border-4 border-pink-300">ğŸŒ¸</div>
            <div onclick="handleCorrectAnswerLevel1()" class="touch-target w-32 h-32 bg-yellow-400 rounded-full flex items-center justify-center text-black font-bold text-3xl shadow-lg border-4 border-yellow-600 coin">â‚¹10</div>
            <div id="item-ball" onclick="handleWrongAnswer('item-ball')" class="touch-target w-32 h-32 bg-red-200 rounded-full flex items-center justify-center text-6xl shadow-md border-4 border-red-300">âš½</div>
        </div>
    </div>

    <!-- SCREEN 3: LEVEL 2 (TRANSACTION - SIMPLE) -->
    <div id="screen-level2" class="hidden h-screen flex flex-col bg-green-50">
        <div class="p-4 flex justify-between items-center bg-white shadow-sm">
            <span class="bg-green-200 text-green-800 px-3 py-1 rounded-full text-sm font-bold">Level 2</span>
            <button onclick="speak('Buy the Apple for 10 Rupees')" class="bg-blue-100 p-2 rounded-full">ğŸ”Š</button>
        </div>
        <div class="flex-1 flex flex-col items-center justify-center mt-4">
            <div class="text-6xl mb-2">ğŸ‘¨ğŸ½â€ğŸŒ¾</div>
            <div class="bg-white p-6 rounded-3xl shadow-xl border-4 border-orange-200 flex flex-col items-center">
                <div class="text-6xl mb-2">ğŸ</div>
                <div class="bg-yellow-300 text-black font-bold px-4 py-1 rounded-full text-xl border-2 border-yellow-500">â‚¹10</div>
            </div>
        </div>
        <div class="bg-gray-800 p-6 rounded-t-3xl mt-auto shadow-2xl pb-12">
            <div class="flex justify-center gap-6">
                <div onclick="handleWrongPay(this)" class="touch-target w-24 h-24 bg-gray-300 rounded-full flex items-center justify-center text-gray-700 font-bold text-2xl shadow-lg border-4 border-gray-400 coin">â‚¹1</div>
                <div onclick="handleCorrectPayL2()" class="touch-target w-24 h-24 bg-yellow-400 rounded-full flex items-center justify-center text-black font-bold text-2xl shadow-lg border-4 border-yellow-600 coin">â‚¹10</div>
                <div onclick="handleWrongPay(this)" class="touch-target w-24 h-24 bg-gray-300 rounded-full flex items-center justify-center text-gray-700 font-bold text-2xl shadow-lg border-4 border-gray-400 coin">â‚¹2</div>
            </div>
        </div>
    </div>

    <!-- SCREEN 4: LEVEL 3 (ADDITION - NEW!) -->
    <div id="screen-level3" class="hidden h-screen flex flex-col bg-blue-50">
        <div class="p-4 flex justify-between items-center bg-white shadow-sm">
            <span class="bg-blue-200 text-blue-800 px-3 py-1 rounded-full text-sm font-bold">Level 3: Summing</span>
            <button onclick="speak('Milk is 12 Rupees. Add coins to pay.')" class="bg-blue-100 p-2 rounded-full">ğŸ”Š</button>
        </div>
        
        <!-- Shop Counter -->
        <div class="flex-1 flex flex-col items-center justify-start pt-8">
            <div class="bg-white p-4 rounded-3xl shadow-xl border-4 border-blue-200 flex items-center gap-4 mb-6">
                <div class="text-6xl">ğŸ¥›</div>
                <div class="text-right">
                    <div class="text-xs text-gray-500 uppercase font-bold">Price</div>
                    <div class="text-4xl font-bold text-blue-600">â‚¹12</div>
                </div>
            </div>

            <!-- Payment Display -->
            <div class="bill-slot p-4 rounded-xl w-64 text-center">
                <div class="text-xs text-gray-400 uppercase mb-1">Total Given</div>
                <div class="text-4xl font-bold">â‚¹ <span id="current-total">0</span></div>
            </div>
            
            <div id="feedback-text" class="h-8 mt-2 text-red-500 font-bold"></div>
        </div>

        <!-- Wallet Area -->
        <div class="bg-gray-800 p-6 rounded-t-3xl mt-auto shadow-2xl pb-8">
            <p class="text-white text-center mb-4 text-sm opacity-70">Tap coins to add to total</p>
            <div class="grid grid-cols-4 gap-2">
                <div onclick="addToTotal(10)" class="touch-target w-20 h-20 bg-yellow-400 rounded-full flex items-center justify-center text-black font-bold text-xl shadow-lg border-4 border-yellow-600 coin mx-auto">â‚¹10</div>
                <div onclick="addToTotal(5)" class="touch-target w-20 h-20 bg-gray-300 rounded-full flex items-center justify-center text-black font-bold text-xl shadow-lg border-4 border-gray-400 coin mx-auto">â‚¹5</div>
                <div onclick="addToTotal(2)" class="touch-target w-20 h-20 bg-gray-300 rounded-full flex items-center justify-center text-black font-bold text-xl shadow-lg border-4 border-gray-400 coin mx-auto">â‚¹2</div>
                <div onclick="addToTotal(1)" class="touch-target w-20 h-20 bg-gray-300 rounded-full flex items-center justify-center text-black font-bold text-xl shadow-lg border-4 border-gray-400 coin mx-auto">â‚¹1</div>
            </div>
            
            <div class="flex gap-4 mt-6">
                <button onclick="resetTotal()" class="flex-1 bg-red-500 text-white font-bold py-3 rounded-xl shadow border-b-4 border-red-700 active:border-b-0 active:mt-1">Reset âŒ«</button>
                <button onclick="checkTotal()" class="flex-1 bg-green-500 text-white font-bold py-3 rounded-xl shadow border-b-4 border-green-700 active:border-b-0 active:mt-1">Pay Now âœ…</button>
            </div>
        </div>
    </div>

    <!-- SUCCESS SCREEN -->
    <div id="screen-success" class="hidden h-screen flex flex-col items-center justify-center bg-purple-600 text-white p-4 text-center">
        <div class="text-8xl mb-6 pop-anim">ğŸ†</div>
        <h1 class="text-5xl font-bold mb-4">Master!</h1>
        <p class="text-2xl mb-8 opacity-90">You finished all levels!</p>
        <button onclick="location.href='index.html'" class="bg-white text-purple-600 hover:bg-gray-100 text-2xl font-bold py-4 px-12 rounded-full shadow-lg transition-all">Back to Menu ğŸ </button>
    </div>
</div>

<script>
    let currentStudentName = "Guest";
    let attemptsCount = 0;
    let currentSum = 0;
    const targetSum = 12; // For Level 3

    window.onload = function() {
        const storedName = localStorage.getItem('saksham_student_name');
        if (storedName && storedName.trim() !== "") {
            currentStudentName = storedName;
            document.getElementById('student-name-input').classList.add('hidden');
            document.getElementById('welcome-message').innerText = "Welcome, " + currentStudentName + "!";
            document.getElementById('welcome-message').classList.remove('hidden');
        } else {
            document.getElementById('student-name-input').classList.remove('hidden');
        }
    };

    const synth = window.speechSynthesis;
    function speak(text) {
        if (synth.speaking) return;
        const u = new SpeechSynthesisUtterance(text);
        u.rate = 0.9;
        synth.speak(u);
    }

    function startGame() {
        const inputVal = document.getElementById('student-name-input').value;
        if (inputVal) { currentStudentName = inputVal; localStorage.setItem('saksham_student_name', currentStudentName); }
        document.getElementById('screen-welcome').classList.add('hidden');
        document.getElementById('screen-level1').classList.remove('hidden');
        setTimeout(() => speak("Namaste. Find the 10 Rupee Coin"), 500);
    }

    // L1 Logic
    function handleWrongAnswer(elementId) {
        document.getElementById(elementId).style.opacity = '0'; attemptsCount++; speak("Try again.");
    }
    function handleCorrectAnswerLevel1() {
        speak("Good!");
        setTimeout(() => {
            document.getElementById('screen-level1').classList.add('hidden');
            document.getElementById('screen-level2').classList.remove('hidden');
            speak("Level 2. Buy the apple for 10 rupees.");
        }, 1000);
    }

    // L2 Logic
    function handleWrongPay(el) {
        el.classList.add('bg-red-300'); setTimeout(() => el.classList.remove('bg-red-300'), 300); attemptsCount++; speak("Wrong coin.");
    }
    function handleCorrectPayL2() {
        speak("Excellent! Now Level 3.");
        setTimeout(() => {
            document.getElementById('screen-level2').classList.add('hidden');
            document.getElementById('screen-level3').classList.remove('hidden');
            speak("Milk is 12 Rupees. Add coins to make 12.");
        }, 1000);
    }

    // L3 Logic (Summing)
    function addToTotal(val) {
        currentSum += val;
        document.getElementById('current-total').innerText = currentSum;
        speak(val + " Rupees added.");
        document.getElementById('feedback-text').innerText = "";
    }
    function resetTotal() {
        currentSum = 0;
        document.getElementById('current-total').innerText = "0";
        speak("Reset.");
    }
    function checkTotal() {
        if (currentSum === targetSum) {
            speak("Payment Successful! You are a math master.");
            document.getElementById('screen-level3').classList.add('hidden');
            document.getElementById('screen-success').classList.remove('hidden');
            sendDataToBackend();
        } else if (currentSum < targetSum) {
            attemptsCount++;
            document.getElementById('feedback-text').innerText = "Need more!";
            speak("Not enough. We need 12.");
        } else {
            attemptsCount++;
            document.getElementById('feedback-text').innerText = "Too much!";
            speak("Too much money. Reset and try again.");
        }
    }

    function sendDataToBackend() {
        const googleScriptURL = "PASTE_YOUR_URL_HERE"; // <--- PASTE HERE
        if (googleScriptURL.includes("script.google.com")) {
            fetch(googleScriptURL, {
                method: 'POST', mode: 'no-cors', 
                body: JSON.stringify({
                    studentId: currentStudentName,
                    module: "Money Math: Advanced",
                    level: "L3 Summing",
                    score: 100,
                    attempts: attemptsCount,
                    timeTaken: 0
                })
            });
        }
    }
</script>
</body>
</html>
